#!/usr/bin/env ruby
# Usage: git changelog-from-parent
#
# checks the current branch name and logs the differences with the parent
SHOW_BRANCH_REGEXP = /.*\[(?<branch_name>.+)\].*/
LOG_FORMAT='- %s%n%w(80,2,2)%b'

def current_branch
  `git rev-parse --abbrev-ref HEAD`.chomp
end

def parent_branch
  `git show-branch -a`.split("\n")[1].match(SHOW_BRANCH_REGEXP)[:branch_name]
end

def log_in_relation_to_base_branch
  system("git log --format='#{LOG_FORMAT}' #{parent_branch}..#{current_branch}")
end

log_in_relation_to_base_branch
